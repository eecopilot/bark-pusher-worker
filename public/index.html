<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bark Push Worker - 任务管理</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="container">
        <!-- Toast Container -->
        <div class="toast-container">
            <div v-for="toast in toasts" :key="toast.id" 
                 :class="['toast', `toast-${toast.type}`, { show: toast.show }]">
                <div class="toast-icon">{{ getToastIcon(toast.type) }}</div>
                <div class="toast-message">{{ toast.message }}</div>
                <button class="toast-close" @click="hideToast(toast.id)">&times;</button>
            </div>
        </div>

        <div class="header">
            <h1>Bark Push Worker</h1>
            <p>推送通知任务管理系统</p>
        </div>

        <!-- Modal for creating new task -->
        <div v-if="showModal" class="modal-overlay" @click="closeModal">
            <div class="modal-content" @click.stop>
                <div class="modal-header">
                    <h2>创建新任务</h2>
                    <button class="close-btn" @click="closeModal">&times;</button>
                </div>
                <form @submit.prevent="handleCreateTask">
                    <div class="form-group">
                        <label for="title">标题 *</label>
                        <input type="text" id="title" v-model="taskForm.title" required>
                    </div>

                    <div class="form-group">
                        <label for="body">内容 *</label>
                        <textarea id="body" v-model="taskForm.body" required></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="scheduledTime">计划发送时间 *</label>
                            <input type="datetime-local" id="scheduledTime" v-model="taskForm.scheduledTime" required>
                        </div>
                        <div class="form-group">
                            <label for="sound">提示音</label>
                            <select id="sound" v-model="taskForm.sound">
                                <option value="">默认</option>
                                <option value="alarm">alarm</option>
                                <option value="anticipate">anticipate</option>
                                <option value="bell">bell</option>
                                <option value="birdsong">birdsong</option>
                                <option value="bloom">bloom</option>
                                <option value="calypso">calypso</option>
                                <option value="chime">chime</option>
                                <option value="choo">choo</option>
                                <option value="descent">descent</option>
                                <option value="electronic">electronic</option>
                                <option value="fanfare">fanfare</option>
                                <option value="glass">glass</option>
                                <option value="gotosleep">gotosleep</option>
                                <option value="healthnotification">healthnotification</option>
                                <option value="horn">horn</option>
                                <option value="ladder">ladder</option>
                                <option value="mailsent">mailsent</option>
                                <option value="minuet">minuet</option>
                                <option value="multiwayinvitation">multiwayinvitation</option>
                                <option value="newmail">newmail</option>
                                <option value="newsflash">newsflash</option>
                                <option value="noir">noir</option>
                                <option value="paymentsuccess">paymentsuccess</option>
                                <option value="shake">shake</option>
                                <option value="sherwoodforest">sherwoodforest</option>
                                <option value="silence">silence</option>
                                <option value="spell">spell</option>
                                <option value="suspense">suspense</option>
                                <option value="telegraph">telegraph</option>
                                <option value="tiptoes">tiptoes</option>
                                <option value="typewriters">typewriters</option>
                                <option value="update">update</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="deviceKey">设备密钥 (可选)</label>
                            <input type="text" id="deviceKey" v-model="taskForm.deviceKey" placeholder="留空使用默认密钥">
                        </div>
                        <div class="form-group">
                            <label for="group">分组 (可选)</label>
                            <input type="text" id="group" v-model="taskForm.group" placeholder="通知分组">
                        </div>
                    </div>

                    <div class="form-row">
                        <button type="submit" class="btn" :disabled="isCreating">
                            {{ isCreating ? '创建中...' : '创建任务' }}
                        </button>
                        <button type="button" class="btn btn-secondary" @click="sendTestPush" :disabled="isTesting">
                            {{ isTesting ? '发送中...' : '发送测试推送' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="tasks-section">
            <div class="tasks-header">
                <h2>任务列表</h2>
                <div class="tasks-header-actions">
                    <button class="btn-create" @click="openModal">+ 创建新任务</button>
                    <button class="btn btn-secondary btn-small" @click="loadTasks" :disabled="isLoading">
                        {{ isLoading ? '加载中...' : '刷新' }}
                    </button>
                </div>
            </div>
            <div v-if="isLoading" class="loading">加载中...</div>
            <div v-else-if="tasks.length === 0" class="empty-state">
                <h3>暂无任务</h3>
                <p>创建你的第一个推送任务吧</p>
            </div>
            <div v-else>
                <div v-for="task in tasks" :key="task.id" class="task-card">
                    <div class="task-header">
                        <div>
                            <div class="task-title">{{ task.title }}</div>
                            <div class="task-body">{{ task.body }}</div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-small btn-danger" @click="deleteTask(task.id)" :disabled="isDeletingTask === task.id">
                                {{ isDeletingTask === task.id ? '删除中...' : '删除' }}
                            </button>
                        </div>
                    </div>
                    <div class="task-meta">
                        <span :class="'task-status status-' + task.status">{{ getStatusText(task.status) }}</span>
                        <span>计划时间: {{ formatDateTime(task.scheduledTime) }}</span>
                        <span>创建时间: {{ formatDateTime(task.createdAt) }}</span>
                        <span v-if="task.sound">提示音: {{ task.sound }}</span>
                        <span v-if="task.group">分组: {{ task.group }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>